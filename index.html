<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Supervised Feature Selection • important</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Supervised Feature Selection">
<meta name="description" content="Interfaces for choosing important predictors in supervised regression, classification, and censored regression models. Permuted importance scores (Biecek and Burzykowski (2021) &lt;doi:10.1201/9780429027192&gt;) can be computed for tidymodels model fits.">
<meta property="og:description" content="Interfaces for choosing important predictors in supervised regression, classification, and censored regression models. Permuted importance scores (Biecek and Burzykowski (2021) &lt;doi:10.1201/9780429027192&gt;) can be computed for tidymodels model fits.">
<script defer data-domain="important.tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">important</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidymodels/important/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="important">important<a class="anchor" aria-label="anchor" href="#important"></a>
</h1></div>
<!-- badges: start -->

<p>The important package has a succinct interface for obtaining estimates of predictor importance with tidymodels objects. A few of the main features:</p>
<ul>
<li>Any performance metrics from the yardstick package can be used.</li>
<li>Importance can be calculated for either the original columns or at the level of any derived model terms created during feature engineering.</li>
<li>The computations that loop across permutation iterations and predictors columns are easily parallelized.</li>
<li>The results are returned in a tidy format.</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of important from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="co"># or</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"tidymodels/important"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="do-we-really-need-another-package-that-computes-variable-importances">Do we really need another package that computes variable importances?<a class="anchor" aria-label="anchor" href="#do-we-really-need-another-package-that-computes-variable-importances"></a>
</h2>
<p>The main reason for making important is censored regression models. tidymodels released tools for fitting and qualifying models that have censored outcomes. This included some dynamic performance metrics that were evaluated at different time points. This was a substantial change for us, and it would have been even more challenging to add to other packages.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Let’s look at an analysis that models <a href="https://aml4td.org/chapters/whole-game.html#sec-delivery-times" class="external-link">food delivery times</a>. The outcome is the time between an order being placed and the delivery (all data are complete - there is no censoring). We model this in terms of the order day/time, the distance to the restaurant, and which items are contained in the order. Exploratory data analysis shows several nonlinear trends in the data and some interactions between these trends.</p>
<p>We’ll load the tidymodels and important packages to get started.</p>
<p>The data are split into training, validation, and testing sets.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">deliveries</span>, package <span class="op">=</span> <span class="st">"modeldata"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">991</span><span class="op">)</span></span>
<span><span class="va">delivery_split</span> <span class="op">&lt;-</span> <span class="fu">initial_validation_split</span><span class="op">(</span><span class="va">deliveries</span>, prop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.2</span><span class="op">)</span>, strata <span class="op">=</span> <span class="va">time_to_delivery</span><span class="op">)</span></span>
<span><span class="va">delivery_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">delivery_split</span><span class="op">)</span></span></code></pre></div>
<p>The model uses a recipe with spline terms for the hour and distances. The nonlinear trend over the time of order changes on the day, so we added interactions between these two sets of terms. Finally, a simple linear regression model is used for estimation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">delivery_rec</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">time_to_delivery</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">delivery_train</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_factor_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">step_zv</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">step_spline_natural</span><span class="op">(</span><span class="va">hour</span>, <span class="va">distance</span>, deg_free <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">step_interact</span><span class="op">(</span><span class="op">~</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">"hour_"</span><span class="op">)</span><span class="op">:</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"day_"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_wflow</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="va">delivery_rec</span>, <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="fu">fit</span><span class="op">(</span><span class="va">lm_wflow</span>, <span class="va">delivery_train</span><span class="op">)</span></span></code></pre></div>
<p>First, let’s capture the effect of the individual model terms. These terms are from the derived features in the models, such as dummy variables, spline terms, interaction columns, etc.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">382</span><span class="op">)</span></span>
<span><span class="va">lm_deriv_imp</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="reference/importance_perm.html">importance_perm</a></span><span class="op">(</span></span>
<span>    <span class="va">lm_fit</span>,</span>
<span>    data <span class="op">=</span> <span class="va">delivery_train</span>,</span>
<span>    metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">mae</span>, <span class="va">rsq</span><span class="op">)</span>,</span>
<span>    times <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"derived"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">lm_deriv_imp</span></span>
<span><span class="co">#&gt; # A tibble: 226 × 6</span></span>
<span><span class="co">#&gt;    .metric predictor             n  mean std_err importance</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;             &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 rsq     distance_10          50 0.528 0.00655       80.5</span></span>
<span><span class="co">#&gt;  2 mae     day_Sat              50 1.09  0.0150        72.2</span></span>
<span><span class="co">#&gt;  3 mae     distance_10          50 2.20  0.0323        68.2</span></span>
<span><span class="co">#&gt;  4 mae     day_Fri              50 0.877 0.0140        62.7</span></span>
<span><span class="co">#&gt;  5 mae     day_Thu              50 0.638 0.0130        49.0</span></span>
<span><span class="co">#&gt;  6 mae     distance_09          50 0.740 0.0156        47.3</span></span>
<span><span class="co">#&gt;  7 mae     hour_08              50 0.520 0.0136        38.3</span></span>
<span><span class="co">#&gt;  8 rsq     day_Sat              50 0.118 0.00327       36.2</span></span>
<span><span class="co">#&gt;  9 rsq     hour_06_x_day_Sat    50 0.146 0.00410       35.7</span></span>
<span><span class="co">#&gt; 10 mae     hour_08_x_day_Sat    50 0.604 0.0173        34.9</span></span>
<span><span class="co">#&gt; # ℹ 216 more rows</span></span></code></pre></div>
<p>Using mean absolute error as the metric of interest, the top 5 features are:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_deriv_imp</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"mae"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">slice_max</span><span class="op">(</span><span class="va">importance</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span><span class="co">#&gt;   .metric predictor       n  mean std_err importance</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 mae     day_Sat        50 1.09   0.0150       72.2</span></span>
<span><span class="co">#&gt; 2 mae     distance_10    50 2.20   0.0323       68.2</span></span>
<span><span class="co">#&gt; 3 mae     day_Fri        50 0.877  0.0140       62.7</span></span>
<span><span class="co">#&gt; 4 mae     day_Thu        50 0.638  0.0130       49.0</span></span>
<span><span class="co">#&gt; 5 mae     distance_09    50 0.740  0.0156       47.3</span></span></code></pre></div>
<p>Two notes:</p>
<ul>
<li><p>The importance scores are the ratio of the mean change in performance and the associated standard error. The mean value is always increasing with importance, no matter which direction is preferred for the specific metric(s).</p></li>
<li><p>We can run these in parallel by loading the future package and specifying a parallel backend using the <code>plan()</code> function.</p></li>
</ul>
<p>There is a plot method that can help visualize the results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">lm_deriv_imp</span>, top <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-derived-plot-1.png" width="100%"></p>
<p>Since there are spline terms and interactions for the hour column, we might not care about the importance of a term such as <code>hour_06</code> (the sixth spline feature). In aggregate, we might want to know the effect of the original predictor columns. The <code>type</code> option is used for this purpose:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">382</span><span class="op">)</span></span>
<span><span class="va">lm_orig_imp</span> <span class="op">&lt;-</span> </span>
<span>    <span class="fu"><a href="reference/importance_perm.html">importance_perm</a></span><span class="op">(</span></span>
<span>        <span class="va">lm_fit</span>,</span>
<span>        data <span class="op">=</span> <span class="va">delivery_train</span>,</span>
<span>        metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">mae</span>, <span class="va">rsq</span><span class="op">)</span>,</span>
<span>        times <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        type <span class="op">=</span> <span class="st">"original"</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Top five: </span></span>
<span><span class="va">lm_orig_imp</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"mae"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">slice_max</span><span class="op">(</span><span class="va">importance</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 6</span></span>
<span><span class="co">#&gt;   .metric predictor     n   mean std_err importance</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 mae     hour         50 4.10    0.0320     128.  </span></span>
<span><span class="co">#&gt; 2 mae     day          50 1.91    0.0214      89.1 </span></span>
<span><span class="co">#&gt; 3 mae     distance     50 1.46    0.0222      66.0 </span></span>
<span><span class="co">#&gt; 4 mae     item_24      50 0.0489  0.0119       4.11</span></span>
<span><span class="co">#&gt; 5 mae     item_03      50 0.0337  0.0114       2.95</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">lm_orig_imp</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-original-plot-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the important project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=important" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/tidymodels/important/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/tidymodels/important/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing important</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/topepo" class="external-link">Max Kuhn</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2402-136X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>
<a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a> <br><small class="roles"> Copyright holder, funder </small>  <a href="https://ror.org/03wc8by49" class="external-link"><img src="https://raw.githubusercontent.com/ror-community/ror-logos/main/ror-icon-rgb.svg" class="ror" alt="ROR"></a> </li>
</ul>
</div>



  </aside>
</div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/topepo" class="external-link">Max Kuhn</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
